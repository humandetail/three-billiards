<!-- <html>
  <body>
    <div
        class="test"
        style="
          position: absolute;
          right: 50%;
          top: 50%;
          transform: translate(50%, -50%);
        "
      >
        <div
          :style="`
            width: ${PARAMETERS.tableWidth}px;
            height: ${PARAMETERS.tableHeight}px;
            border: 1px solid black;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="外边"
          :style="`
            position: absolute;
            top: ${-PARAMETERS.middlePocketRadius}px;
            left: ${-PARAMETERS.middlePocketRadius}px;
            width: ${PARAMETERS.tableWidth + PARAMETERS.middlePocketRadius * 2}px;
            height: ${PARAMETERS.tableHeight + PARAMETERS.middlePocketRadius * 2}px;
            border: 1px dashed red;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="左上"
          :style="`
            position: absolute;
            top: ${-PARAMETERS.cornerPocketRadius + cs}px;
            left: ${-PARAMETERS.cornerPocketRadius + cs}px;
            width: ${PARAMETERS.cornerPocketRadius * 2}px;
            height: ${PARAMETERS.cornerPocketRadius * 2}px;
            border-radius: 50%;
            border: 1px solid orange;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="右上"
          :style="`
            position: absolute;
            top: ${-PARAMETERS.cornerPocketRadius + cs}px;
            left: ${PARAMETERS.tableWidth - PARAMETERS.cornerPocketRadius - cs}px;
            width: ${PARAMETERS.cornerPocketRadius * 2}px;
            height: ${PARAMETERS.cornerPocketRadius * 2}px;
            border-radius: 50%;
            border: 1px solid orange;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="左下"
          :style="`
            position: absolute;
            top: ${PARAMETERS.tableHeight - PARAMETERS.cornerPocketRadius - cs}px;
            left: ${-PARAMETERS.cornerPocketRadius + cs}px;
            width: ${PARAMETERS.cornerPocketRadius * 2}px;
            height: ${PARAMETERS.cornerPocketRadius * 2}px;
            border-radius: 50%;
            border: 1px solid orange;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="右下"
          :style="`
            position: absolute;
            top: ${PARAMETERS.tableHeight - PARAMETERS.cornerPocketRadius - cs}px;
            left: ${PARAMETERS.tableWidth - PARAMETERS.cornerPocketRadius - cs}px;
            width: ${PARAMETERS.cornerPocketRadius * 2}px;
            height: ${PARAMETERS.cornerPocketRadius * 2}px;
            border-radius: 50%;
            border: 1px solid orange;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="中上"
          :style="`
            position: absolute;
            top: -${PARAMETERS.cornerPocketRadius}px;
            left: ${PARAMETERS.tableWidth / 2 - PARAMETERS.middlePocketRadius}px;
            width: ${PARAMETERS.middlePocketRadius * 2}px;
            height: ${PARAMETERS.middlePocketRadius * 2}px;
            border-radius: 50%;
            border: 1px solid orange;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="中下"
          :style="`
            position: absolute;
            top: ${PARAMETERS.tableHeight - PARAMETERS.middlePocketRadius}px;
            left: ${PARAMETERS.tableWidth / 2 - PARAMETERS.middlePocketRadius}px;
            width: ${PARAMETERS.middlePocketRadius * 2}px;
            height: ${PARAMETERS.middlePocketRadius * 2}px;
            border-radius: 50%;
            border: 1px solid orange;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="白球"
          :style="`
            position: absolute;
            top: ${PARAMETERS.cornerPocketRadius - PARAMETERS.ballRadius}px;
            left: ${PARAMETERS.cornerPocketRadius - PARAMETERS.ballRadius}px;
            width: ${PARAMETERS.ballRadius * 2}px;
            height: ${PARAMETERS.ballRadius * 2}px;
            border-radius: 50%;
            border: 1px solid red;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="左上库边"
          :style="`
            position: absolute;
            top: ${0}px;
            left: ${PARAMETERS.cornerPocketRadius + cs}px;
            width: ${PARAMETERS.tableWidth / 2 - PARAMETERS.cornerPocketRadius - cs - PARAMETERS.middlePocketRadius}px;
            height: ${PARAMETERS.cornerPocketWidth}px;
            border: 1px solid green;
            border-bottom-left-radius: ${PARAMETERS.cornerPocketWidth}px;
            border-bottom-right-radius: ${PARAMETERS.cornerPocketWidth}px;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="右上库边"
          :style="`
            position: absolute;
            top: ${0}px;
            left: ${PARAMETERS.tableWidth / 2 + PARAMETERS.middlePocketRadius}px;
            width: ${PARAMETERS.tableWidth / 2 - PARAMETERS.cornerPocketRadius - cs - PARAMETERS.middlePocketRadius}px;
            height: ${PARAMETERS.cornerPocketWidth}px;
            border: 1px solid green;
            border-bottom-left-radius: ${PARAMETERS.cornerPocketWidth}px;
            border-bottom-right-radius: ${PARAMETERS.cornerPocketWidth}px;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="右库边"
          :style="`
            position: absolute;
            top: ${0 + PARAMETERS.cornerPocketRadius + cs}px;
            right: ${0}px;
            width: ${PARAMETERS.cornerPocketWidth}px;
            height: ${PARAMETERS.tableHeight - (PARAMETERS.cornerPocketRadius + cs) * 2}px;
            border: 1px solid green;
            border-top-left-radius: ${PARAMETERS.cornerPocketWidth}px;
            border-bottom-left-radius: ${PARAMETERS.cornerPocketWidth}px;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="右下库边"
          :style="`
            position: absolute;
            bottom: ${0}px;
            left: ${PARAMETERS.tableWidth / 2 + PARAMETERS.middlePocketRadius}px;
            width: ${PARAMETERS.tableWidth / 2 - PARAMETERS.cornerPocketRadius - cs - PARAMETERS.middlePocketRadius}px;
            height: ${PARAMETERS.cornerPocketWidth}px;
            border: 1px solid green;
            border-top-left-radius: ${PARAMETERS.cornerPocketWidth}px;
            border-top-right-radius: ${PARAMETERS.cornerPocketWidth}px;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="左下库边"
          :style="`
            position: absolute;
            bottom: ${0}px;
            left: ${PARAMETERS.cornerPocketRadius + cs}px;
            width: ${PARAMETERS.tableWidth / 2 - PARAMETERS.cornerPocketRadius - cs - PARAMETERS.middlePocketRadius}px;
            height: ${PARAMETERS.cornerPocketWidth}px;
            border: 1px solid green;
            border-top-left-radius: ${PARAMETERS.cornerPocketWidth}px;
            border-top-right-radius: ${PARAMETERS.cornerPocketWidth}px;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="左库边"
          :style="`
            position: absolute;
            top: ${PARAMETERS.cornerPocketRadius + cs}px;
            left: ${0}px;
            width: ${PARAMETERS.cornerPocketWidth}px;
            height: ${PARAMETERS.tableHeight - (PARAMETERS.cornerPocketRadius + cs) * 2}px;
            border: 1px solid green;
            border-top-right-radius: ${PARAMETERS.cornerPocketWidth}px;
            border-bottom-right-radius: ${PARAMETERS.cornerPocketWidth}px;
            box-sizing: border-box;
          `"
        ></div>
      </div>
  </body>
</html> -->

<!DOCTYPE html>
<html>
<head>
  <title>Cannon.js 扇形 Demo</title>
  <style> body { margin: 0; } </style>
</head>
<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/cannon-es@0.19.0/dist/cannon-es.js"></script>

<script>
// 初始化 Three.js
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// 初始化 Cannon.js
const world = new CANNON.World();
world.gravity.set(0, -9.82, 0);

// 创建扇形物理体
function createFanBody() {
  // 扇形参数
  const radius = 2;
  const startAngle = -Math.PI/4;
  const endAngle = Math.PI/4;
  const segments = 8;
  const height = 0.2;

  // 生成顶点
  const vertices = [];
  for (let side = 0; side < 2; side++) {
    const z = side === 0 ? height/2 : -height/2;
    vertices.push(new CANNON.Vec3(0, 0, z)); // 圆心
    for (let i = 0; i <= segments; i++) {
      const theta = startAngle + (endAngle - startAngle) * (i/segments);
      const x = radius * Math.cos(theta);
      const y = radius * Math.sin(theta);
      vertices.push(new CANNON.Vec3(x, y, z));
    }
  }

  // 生成三角面
  const faces = [];
  // 侧面
  for (let i = 1; i <= segments; i++) {
    const topCurrent = i;
    const topNext = i + 1;
    const bottomCurrent = segments + 2 + i;
    const bottomNext = segments + 2 + i + 1;

    faces.push([topCurrent, bottomCurrent, topNext]);
    faces.push([topNext, bottomCurrent, bottomNext]);
  }
  // 顶面/底面
  for (let side = 0; side < 2; side++) {
    const offset = side === 0 ? 0 : segments + 2;
    for (let i = 1; i <= segments; i++) {
      faces.push([offset, offset + i, offset + i + 1]);
    }
  }

  // 创建物理体
  const shape = new CANNON.ConvexPolyhedron({ vertices, faces });
  const body = new CANNON.Body({
    mass: 1,
    position: new CANNON.Vec3(0, 5, 0),
    angularVelocity: new CANNON.Vec3(0, 2, 0) // 初始旋转
  });
  body.addShape(shape);
  return body;
}

// 创建 Three.js 扇形可视化
function createFanMesh(body) {
  const geometry = new THREE.BufferGeometry();
  const positions = [];
  
  // 将Cannon顶点转换为Three.js格式
  body.shapes[0].vertices.forEach(v => {
    positions.push(v.x, v.y, v.z);
  });

  // 生成索引
  const indices = [];
  body.shapes[0].faces.forEach(face => {
    indices.push(face[0], face[1], face[2]);
  });

  geometry.setIndex(indices);
  geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
  geometry.computeVertexNormals();

  const material = new THREE.MeshPhongMaterial({ 
    color: 0x00ff00,
    transparent: true,
    opacity: 0.8
  });
  return new THREE.Mesh(geometry, material);
}

// 创建地面
const groundBody = new CANNON.Body({ mass: 0, shape: new CANNON.Plane() });
groundBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1,0,0), -Math.PI/2);
world.addBody(groundBody);

const groundMesh = new THREE.Mesh(
  new THREE.PlaneGeometry(20, 20),
  new THREE.MeshPhongMaterial({ color: 0x444444 })
);
groundMesh.rotation.x = -Math.PI/2;
scene.add(groundMesh);

// 添加灯光
scene.add(new THREE.AmbientLight(0xffffff, 0.5));
const light = new THREE.DirectionalLight(0xffffff, 0.8);
light.position.set(10, 10, 10);
scene.add(light);

// 创建并添加扇形
const fanBody = createFanBody();
world.addBody(fanBody);
const fanMesh = createFanMesh(fanBody);
scene.add(fanMesh);

// 添加测试小球
const ballGeometry = new THREE.SphereGeometry(0.3);
const ballMaterial = new THREE.MeshPhongMaterial({ color: 0xff0000 });
const ballMesh = new THREE.Mesh(ballGeometry, ballMaterial);
scene.add(ballMesh);

const ballBody = new CANNON.Body({
  mass: 1,
  position: new CANNON.Vec3(3, 5, 0),
  shape: new CANNON.Sphere(0.3)
});
world.addBody(ballBody);

// 调整相机
camera.position.set(8, 8, 8);
camera.lookAt(0, 0, 0);

// 动画循环
function animate() {
  requestAnimationFrame(animate);
  world.step(1/60);
  
  // 同步扇形位置
  fanMesh.position.copy(fanBody.position);
  fanMesh.quaternion.copy(fanBody.quaternion);
  
  // 同步小球位置
  ballMesh.position.copy(ballBody.position);
  ballMesh.quaternion.copy(ballBody.quaternion);
  
  renderer.render(scene, camera);
}

animate();
</script>
</body>
</html>