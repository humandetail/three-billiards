<!-- <html>
  <body>
    <div
        class="test"
        style="
          position: absolute;
          right: 50%;
          top: 50%;
          transform: translate(50%, -50%);
        "
      >
        <div
          :style="`
            width: ${PARAMETERS.tableWidth}px;
            height: ${PARAMETERS.tableHeight}px;
            border: 1px solid black;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="外边"
          :style="`
            position: absolute;
            top: ${-PARAMETERS.middlePocketRadius}px;
            left: ${-PARAMETERS.middlePocketRadius}px;
            width: ${PARAMETERS.tableWidth + PARAMETERS.middlePocketRadius * 2}px;
            height: ${PARAMETERS.tableHeight + PARAMETERS.middlePocketRadius * 2}px;
            border: 1px dashed red;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="左上"
          :style="`
            position: absolute;
            top: ${-PARAMETERS.cornerPocketRadius + cs}px;
            left: ${-PARAMETERS.cornerPocketRadius + cs}px;
            width: ${PARAMETERS.cornerPocketRadius * 2}px;
            height: ${PARAMETERS.cornerPocketRadius * 2}px;
            border-radius: 50%;
            border: 1px solid orange;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="右上"
          :style="`
            position: absolute;
            top: ${-PARAMETERS.cornerPocketRadius + cs}px;
            left: ${PARAMETERS.tableWidth - PARAMETERS.cornerPocketRadius - cs}px;
            width: ${PARAMETERS.cornerPocketRadius * 2}px;
            height: ${PARAMETERS.cornerPocketRadius * 2}px;
            border-radius: 50%;
            border: 1px solid orange;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="左下"
          :style="`
            position: absolute;
            top: ${PARAMETERS.tableHeight - PARAMETERS.cornerPocketRadius - cs}px;
            left: ${-PARAMETERS.cornerPocketRadius + cs}px;
            width: ${PARAMETERS.cornerPocketRadius * 2}px;
            height: ${PARAMETERS.cornerPocketRadius * 2}px;
            border-radius: 50%;
            border: 1px solid orange;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="右下"
          :style="`
            position: absolute;
            top: ${PARAMETERS.tableHeight - PARAMETERS.cornerPocketRadius - cs}px;
            left: ${PARAMETERS.tableWidth - PARAMETERS.cornerPocketRadius - cs}px;
            width: ${PARAMETERS.cornerPocketRadius * 2}px;
            height: ${PARAMETERS.cornerPocketRadius * 2}px;
            border-radius: 50%;
            border: 1px solid orange;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="中上"
          :style="`
            position: absolute;
            top: -${PARAMETERS.cornerPocketRadius}px;
            left: ${PARAMETERS.tableWidth / 2 - PARAMETERS.middlePocketRadius}px;
            width: ${PARAMETERS.middlePocketRadius * 2}px;
            height: ${PARAMETERS.middlePocketRadius * 2}px;
            border-radius: 50%;
            border: 1px solid orange;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="中下"
          :style="`
            position: absolute;
            top: ${PARAMETERS.tableHeight - PARAMETERS.middlePocketRadius}px;
            left: ${PARAMETERS.tableWidth / 2 - PARAMETERS.middlePocketRadius}px;
            width: ${PARAMETERS.middlePocketRadius * 2}px;
            height: ${PARAMETERS.middlePocketRadius * 2}px;
            border-radius: 50%;
            border: 1px solid orange;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="白球"
          :style="`
            position: absolute;
            top: ${PARAMETERS.cornerPocketRadius - PARAMETERS.ballRadius}px;
            left: ${PARAMETERS.cornerPocketRadius - PARAMETERS.ballRadius}px;
            width: ${PARAMETERS.ballRadius * 2}px;
            height: ${PARAMETERS.ballRadius * 2}px;
            border-radius: 50%;
            border: 1px solid red;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="左上库边"
          :style="`
            position: absolute;
            top: ${0}px;
            left: ${PARAMETERS.cornerPocketRadius + cs}px;
            width: ${PARAMETERS.tableWidth / 2 - PARAMETERS.cornerPocketRadius - cs - PARAMETERS.middlePocketRadius}px;
            height: ${PARAMETERS.cornerPocketWidth}px;
            border: 1px solid green;
            border-bottom-left-radius: ${PARAMETERS.cornerPocketWidth}px;
            border-bottom-right-radius: ${PARAMETERS.cornerPocketWidth}px;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="右上库边"
          :style="`
            position: absolute;
            top: ${0}px;
            left: ${PARAMETERS.tableWidth / 2 + PARAMETERS.middlePocketRadius}px;
            width: ${PARAMETERS.tableWidth / 2 - PARAMETERS.cornerPocketRadius - cs - PARAMETERS.middlePocketRadius}px;
            height: ${PARAMETERS.cornerPocketWidth}px;
            border: 1px solid green;
            border-bottom-left-radius: ${PARAMETERS.cornerPocketWidth}px;
            border-bottom-right-radius: ${PARAMETERS.cornerPocketWidth}px;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="右库边"
          :style="`
            position: absolute;
            top: ${0 + PARAMETERS.cornerPocketRadius + cs}px;
            right: ${0}px;
            width: ${PARAMETERS.cornerPocketWidth}px;
            height: ${PARAMETERS.tableHeight - (PARAMETERS.cornerPocketRadius + cs) * 2}px;
            border: 1px solid green;
            border-top-left-radius: ${PARAMETERS.cornerPocketWidth}px;
            border-bottom-left-radius: ${PARAMETERS.cornerPocketWidth}px;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="右下库边"
          :style="`
            position: absolute;
            bottom: ${0}px;
            left: ${PARAMETERS.tableWidth / 2 + PARAMETERS.middlePocketRadius}px;
            width: ${PARAMETERS.tableWidth / 2 - PARAMETERS.cornerPocketRadius - cs - PARAMETERS.middlePocketRadius}px;
            height: ${PARAMETERS.cornerPocketWidth}px;
            border: 1px solid green;
            border-top-left-radius: ${PARAMETERS.cornerPocketWidth}px;
            border-top-right-radius: ${PARAMETERS.cornerPocketWidth}px;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="左下库边"
          :style="`
            position: absolute;
            bottom: ${0}px;
            left: ${PARAMETERS.cornerPocketRadius + cs}px;
            width: ${PARAMETERS.tableWidth / 2 - PARAMETERS.cornerPocketRadius - cs - PARAMETERS.middlePocketRadius}px;
            height: ${PARAMETERS.cornerPocketWidth}px;
            border: 1px solid green;
            border-top-left-radius: ${PARAMETERS.cornerPocketWidth}px;
            border-top-right-radius: ${PARAMETERS.cornerPocketWidth}px;
            box-sizing: border-box;
          `"
        ></div>

        <div
          name="左库边"
          :style="`
            position: absolute;
            top: ${PARAMETERS.cornerPocketRadius + cs}px;
            left: ${0}px;
            width: ${PARAMETERS.cornerPocketWidth}px;
            height: ${PARAMETERS.tableHeight - (PARAMETERS.cornerPocketRadius + cs) * 2}px;
            border: 1px solid green;
            border-top-right-radius: ${PARAMETERS.cornerPocketWidth}px;
            border-bottom-right-radius: ${PARAMETERS.cornerPocketWidth}px;
            box-sizing: border-box;
          `"
        ></div>
      </div>
  </body>
</html> -->

<!DOCTYPE html>
<html>
<head>
    <title>Cannon.js 漏斗Demo</title>
    <style>body { margin: 0; }</style>
</head>
<body>
  <!-- 基础 Three.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<!-- 扩展线条库 -->
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/lines/Line2.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/lines/LineMaterial.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/lines/LineGeometry.js"></script>
<script>
// 初始化场景、相机、渲染器
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// 灯光设置
const ambientLight = new THREE.AmbientLight(0x404040);
scene.add(ambientLight);
const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
directionalLight.position.set(10, 20, 10);
scene.add(directionalLight);

// 创建抗锯齿宽线漏斗
function createLineFunnel(topR, bottomR, height, segments, thickness, lineWidth) {
  const vertices = [];
  const indices = [];

  // === 1. 生成顶点数据（保持原方案结构） ===
  for (let side = 0; side < 2; side++) { // 0=外壁, 1=内壁
    const radiusOffset = side === 0 ? thickness : 0;
    for (let y = 0; y <= segments; y++) {
      const progress = y / segments;
      const radius = topR + (bottomR - topR) * progress - radiusOffset;
      const angleStep = (Math.PI * 2) / segments;
      for (let i = 0; i <= segments; i++) {
        const angle = i * angleStep;
        vertices.push(
          radius * Math.cos(angle),
          -height/2 + progress * height,
          radius * Math.sin(angle)
        );
      }
    }
  }

  // === 2. 生成线段索引 ===
  // 内外壁纵向线
  for (let side = 0; side < 2; side++) {
    const offset = side * (segments + 1) * (segments + 1);
    for (let y = 0; y < segments; y++) {
      for (let i = 0; i <= segments; i++) {
        const a = offset + y * (segments + 1) + i;
        const b = a + (segments + 1);
        indices.push(a, b);
      }
    }
  }

  // 内外壁横向线
  for (let side = 0; side < 2; side++) {
    const offset = side * (segments + 1) * (segments + 1);
    for (let y = 0; y <= segments; y++) {
      for (let i = 0; i < segments; i++) {
        const a = offset + y * (segments + 1) + i;
        const b = a + 1;
        indices.push(a, b);
      }
    }
  }

  // 连接内外壁的垂直线
  for (let y = 0; y <= segments; y++) {
    for (let i = 0; i <= segments; i++) {
      const outerIdx = y * (segments + 1) + i;
      const innerIdx = outerIdx + (segments + 1) * (segments + 1);
      indices.push(outerIdx, innerIdx);
    }
  }

  // === 3. 转换为 LineGeometry ===
  const lineGeo = new THREE.LineGeometry();
  const linePositions = [];
  
  // 将顶点索引转换为连续的线段数据
  for (let i = 0; i < indices.length; i += 2) {
    const startIdx = indices[i];
    const endIdx = indices[i + 1];
    linePositions.push(
      vertices[startIdx * 3],     // 起点X
      vertices[startIdx * 3 + 1], // 起点Y
      vertices[startIdx * 3 + 2], // 起点Z
      vertices[endIdx * 3],       // 终点X
      vertices[endIdx * 3 + 1],   // 终点Y
      vertices[endIdx * 3 + 2]    // 终点Z
    );
  }
  lineGeo.setPositions(linePositions);

  // === 4. 创建宽线材质 ===
  const lineMaterial = new THREE.LineMaterial({
    color: 0x00ff88,           // 线条颜色
    linewidth: lineWidth,      // 线宽（单位由worldUnits决定）
    resolution: new THREE.Vector2(window.innerWidth, window.innerHeight),
    worldUnits: false,         // false: 线宽单位为像素, true: 使用三维单位
    dashed: false,             // 是否虚线
    alphaToCoverage: true      // 优化透明度渲染
  });

  // === 5. 创建最终线条对象 ===
  const line = new THREE.Line2(lineGeo, lineMaterial);
  line.computeLineDistances(); // 用于虚线计算（本例未启用）

  return line;
}

// 创建漏斗实例（线宽设为5像素）
const funnel = createLineFunnel(
  5,   // 顶部半径
  1,   // 底部半径
  10,  // 高度
  8,   // 分段数（控制网格密度）
  0.3, // 壁厚
  5    // 线宽（像素）
);
scene.add(funnel);

// 相机位置
camera.position.z = 25;

// 窗口大小变化响应
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
  // 更新所有LineMaterial的分辨率
  scene.traverse(obj => {
    if (obj.isLine2 && obj.material.isLineMaterial) {
      obj.material.resolution.set(window.innerWidth, window.innerHeight);
    }
  });
});

// 动画循环
function animate() {
  requestAnimationFrame(animate);
  funnel.rotation.y += 0.01; // 旋转演示
  renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>